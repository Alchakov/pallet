const $=jQuery.noConflict();(()=>{const $window=$(window);let currentPage=1;let isLoading=!1;class Brands_Filter{constructor(){this.$container=$("#brands-list");this.$count=$("#brands-count");this.init()}init(){const self=this;$(document).on("change",".brands-filters input",function(){currentPage=1;self.loadBrands()});$(document).on("change","#brands-region-select",function(){currentPage=1;self.loadBrands()});$(document).on("input","#brands-city-input",function(){currentPage=1;self.loadBrands()});$(document).on("click",".brands-view-btn",function(e){e.preventDefault();const view=$(this).data("view");$(".brands-view-btn").removeClass("active");$(this).addClass("active");self.$container.attr("data-view",view)});$(document).on("click","#reset-filters",function(){$(".brands-filters input").prop("checked",!1);currentPage=1;self.loadBrands()})}getFilters(){const filters={};const regionVal=$("#brands-region-select").val();if(regionVal){filters.regions=regionVal}const activeCategory=$(".brands-filters__nav a.active");if(activeCategory.length){const href=activeCategory.attr("href");const match=href.match(/kategorii-proizvoditeley\/([^\/]+)/);if(match){filters.categories=match[1]}}const minOrders=[];$('input[name="min_order[]"]:checked').each(function(){minOrders.push($(this).val())});if(minOrders.length)filters.min_order=minOrders.join(",");const customizations=[];$('input[name="customization[]"]:checked').each(function(){customizations.push($(this).val())});if(customizations.length)filters.customization=customizations.join(",");if($('input[name="has_price"]:checked').length){filters.has_price=1}const city=$("#brands-city-input").val()?$("#brands-city-input").val().trim():"";if(city){filters.city=city}filters.paged=currentPage;filters.per_page=12;return filters}loadBrands(){const self=this;if(isLoading)return;isLoading=!1;const filters=this.getFilters();this.$container.addClass("loading");$.ajax({url:"/wp-json/pallet/v1/brands-filter",method:"GET",data:filters,dataType:"json",success:function(response){self.$container.removeClass("loading");self.$container.html(response.brands);self.$count.text("Найдено "+response.found_posts+" производителей")},error:function(){self.$container.removeClass("loading");self.$container.html("<p>Ошибка загрузки данных</p>")},complete:function(){isLoading=!1}})}}$window.on("DOMContentLoaded",function(){if($("#brands-list").length){new Brands_Filter()}})})();

