"use strict";function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var $=jQuery.noConflict();!function(){var e=$(window),n=void 0,s=void 0,i=void 0,t=void 0,a=void 0,l=void 0,c={},o=new function e(){var o=this;_classCallCheck(this,e),this.init=function(){var e=o;ymaps.ready(function(){(n=new ymaps.Map("offces-map",{center:[55.751279,37.621131],zoom:9,controls:["zoomControl"]})).behaviors.disable("scrollZoom"),i=new ymaps.ObjectManager({clusterize:!0,gridSize:32,clusterDisableClickZoom:!1}),$.ajax({url:"/wp-content/themes/pallet/assets/offices.json",async:!1,cache:!1}).done(function(e){s=e}),e.baloonConfig(),e.objectManagerConfig(),n.geoObjects.add(i),e.addPoints(),i.objects.events.add(["click"],e.moveToPoint),e.baloonTrigger()})},this.objectManagerConfig=function(){i=new ymaps.ObjectManager({clusterize:!0,gridSize:32,clusterDisableClickZoom:!1});var e={iconLayout:"default#imageWithContent",iconImageSize:[170,171],iconImageOffset:[-76,-114],balloonShadow:!0,balloonLayout:a,balloonContentLayout:l,balloonPanelMaxMapArea:0,hideIconOnBalloonOpen:!1,balloonOffset:t.offset};i.objects.options.set(e),i.clusters.options.set({preset:"islands#redClusterIcons"})},this.addPoints=function(){var t={type:"FeatureCollection",features:[]},n=void 0;$.each(s,function(e,o){c[o.id]="/wp-content/themes/pallet/assets/images/pin-"+o.type+".png",n={type:"Feature",id:o.id,geometry:{type:"Point",coordinates:o.coords.split(",")},properties:{balloonId:o.balloonId,balloonTitle:o.title,balloonAdress:o.address,balloonPhone:o.phone,balloonWorkTime:o.timetable,balloonImgUrl:o.balloonImgUrl},options:{iconImageHref:c[o.id]}},t.features.push(n)}),i.add(t)},this.moveToPoint=function(e){if("click"==e.get("type")){var o=e.get("objectId"),t=i.objects.getById(o).geometry.coordinates;n.setCenter(t,n.getZoom())}},this.baloonTrigger=function(){var t=i.objects;t.events.add(["balloonopen"],function(e){var o=e.get("objectId");t.setObjectOptions(o,{iconImageHref:"/wp-content/themes/pallet/assets/images/pin-active.png"})}).add(["balloonclose"],function(e){var o=e.get("objectId");t.setObjectOptions(o,{iconImageHref:c[o]})})},this.baloonConfig=function(){t={content:'<div class="office-baloon__left"><p class="office-baloon__title">$[properties.balloonTitle]</p><p class="office-baloon__address">$[properties.balloonAdress]</p></div><div class="office-baloon__right"><img class="office-baloon__pic" src="$[properties.balloonImgUrl]" alt=""></div><div class="clearfix"><p class="office-baloon__phone">$[properties.balloonPhone]</p><p class="office-baloon__timetable">$[properties.balloonWorkTime]</p></div>',offset:[0,0]},a=ymaps.templateLayoutFactory.createClass('<div class="office-baloon"><div class="office-baloon__arrow"> </div>$[[options.contentLayout]]</div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=$(".office-baloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".close").on("click",$.proxy(this.onCloseClick,this))},clear:function(){this._$element.find(".close").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){a.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){this._$element.css({left:767<$(window).width()?-220:-110,top:20})},onCloseClick:function(e){e.preventDefault(),this.events.fire("userclose")},getShape:function(){if(!this._isElement(this._$element))return a.superclass.getShape.call(this);var e=this._$element.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[e.left,e.top],[e.left+this._$element[0].offsetWidth,e.top+this._$element[0].offsetHeight+this._$element.find(".office-baloon__arrow")[0].offsetHeight]]))},_isElement:function(e){return e&&e[0]&&e.find(".office-baloon__arrow")[0]}}),l=ymaps.templateLayoutFactory.createClass('<div class="office-baloon__inner"><a class="close" href="#"><span class="icon-cross"></span></a>'+t.content+"</div>")}};e.on("DOMContentLoaded",o.init())}();